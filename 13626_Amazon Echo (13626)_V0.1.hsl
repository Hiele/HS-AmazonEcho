# -*- coding: iso8859-1 -*-
## -----------------------------------------------------
## Amazon Echo (13626)   ### V0.1
##
## erstellt am: 2016-12-06 12:26
## -----------------------------------------------------
## Copyright © 2016, Werner Lindbüchl, All rights reserved.
##
## This program is free software; you can redistribute it and/or modify it under the terms
## of the GNU General Public License as published by the Free Software Foundation; either
## version 3 of the License, or (at your option) any later version.
##
## This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
## without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
## See the GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License along with this program;
## if not, see <http://www.gnu.de/documents/gpl-3.0.de.html>.

## -- 
## --  

#5000|"Text"|Remanent(1/0)|Anz.Eingänge|.n.|Anzahl Ausgänge|.n.|.n.
5000|"Weitere Bausteine\Amazon Echo (13626)_V0.1"|1|3|"E1 Https-Server Start/Stop"|"E2 Https-Server Port"|"E3 Access Token"|1|"A1 Systemlog"|"V0.1"

#5001|Anzahl Eingänge|Ausgänge|Offset|Speicher|Berechnung bei Start
5001|3|1|1|2|1

# Eingaenge
#5002|Index Eingang|Default Wert|0=numerisch 1=alphanummerisch
5002|1|0|0	#* E1 Https-Server Start/Stop 
5002|2|0|0	#* E2 Https-Server Port 
5002|3|0|1	#* E3 Access Token 

# Speicher
#5003|Speicher|Initwert|Remanent
5003|1||0		  #* 
5003|2||1		  #* 

# Ausgaenge
#5004|ausgang|Initwert|runden binär (0/1)|typ (1-send/2-sbc)|0=numerisch 1=alphanummerisch
5004|1|""|0|1|1 

#################################################

5012|0|"OC[1]"|"eval(compile(__import__('base64').decodestring('CmlmIE9DWzFdPT0xOgogIGdsb2JhbCBIUwogIEhTID0gVHJ1ZQogIGdsb2JhbCBhc0RpY3QKICBkZWYgYXNEaWN0KG8pOgogICAgICByZXR1cm4gby5fX2RpY3RfXwogIGdsb2JhbCBIVFRQU2VydmVyCiAgZ2xvYmFsIEJhc2VIVFRQUmVxdWVzdEhhbmRsZXIKICBmcm9tIEJhc2VIVFRQU2VydmVyIGltcG9ydCBIVFRQU2VydmVyLEJhc2VIVFRQUmVxdWVzdEhhbmRsZXIKICBnbG9iYWwgVGhyZWFkaW5nTWl4SW4KICBmcm9tIFNvY2tldFNlcnZlciBpbXBvcnQgVGhyZWFkaW5nTWl4SW4KICBnbG9iYWwganNvbgogIGltcG9ydCBqc29uCiAgZ2xvYmFsIEFtYXpvbkVjaG9XZWJDYWxsYmFjawogIGNsYXNzIEFtYXpvbkVjaG9XZWJDYWxsYmFjayhvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHBJdGVtLCBjYWxsYmFjaywgbmFtZSwgdHlwZT0ndGV4dC9odG1sJyk6CiAgICAgIHNlbGYubG9naWsgPSBwSXRlbQogICAgICBzZWxmLmNhbGxiYWNrID0gY2FsbGJhY2sKICAgICAgc2VsZi5NQyA9IHBJdGVtLk1DCiAgICAgIHNlbGYuVXJsUGZhZCA9IG5hbWUudXBwZXIoKQogICAgICBzZWxmLkRhdE5hbWUgPSAiT1BULyVzIiAlIChzZWxmLlVybFBmYWQpCiAgICAgIHNlbGYuRGF0TGVuID0gMAogICAgICBzZWxmLlR5cCA9IHR5cGUKICAgICAgc2VsZi5pc1F1YWQgPSAwCiAgICAgIHNlbGYuTUMuR1VJLkV4dERhdFVybFtzZWxmLlVybFBmYWRdID0gc2VsZgogICAgZGVmIGdldERhdGVuKHNlbGYpOgogICAgICByZXR1cm4KICAgIGRlZiBnZXRRdWFkRGF0ZW4oc2VsZik6CiAgICAgIHJldHVybiAKICAgIGRlZiBnZXREYXRlblN0cmVhbShzZWxmLCBzdHJlYW0pOgogICAgICBzZWxmLkRhdExlbiA9IHNlbGYuY2FsbGJhY2soc3RyZWFtKQogICAgZGVmIGdldFF1YWREYXRlblN0cmVhbShzZWxmLCBzdHJlYW0pOgogICAgICBzZWxmLmdldERhdGVuU3RyZWFtKHN0cmVhbSkKICBnbG9iYWwgQW1hem9uRWNobwogIGNsYXNzIEFtYXpvbkVjaG8oVGhyZWFkaW5nTWl4SW4sIEhUVFBTZXJ2ZXIpOgogICAgaWYgSFM6CiAgICAgIFBBVEhfQkFTRSA9ICIvdG1wLyIKICAgIGVsc2U6CiAgICAgIFBBVEhfQkFTRSA9ICIiCiAgICBGSUxFTkFNRV9DRVJUID0gImFtYXpvbkVjaG9TU0wuY2VydCIKICAgIEZJTEVQQVRIX0NFUlQgPSBQQVRIX0JBU0UgKyBGSUxFTkFNRV9DRVJUCiAgICBVUkxfQkFTRSA9ICJhbWF6b25FY2hvLyIKICAgIFVSTF9TSE9XX1NTTCA9IFVSTF9CQVNFICsgInNzbENlcnQuaHRtIgogICAgYWxsb3dfcmV1c2VfYWRkcmVzcyA9IFRydWUKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBsb2NhbHMpOgogICAgICBzZWxmLmxvY2FscyA9IGxvY2FsczsKICAgICAgc2VsZi5sb2dpayA9IGxvY2Fsc1sncEl0ZW0nXQogICAgICBzZWxmLk1DID0gc2VsZi5sb2dpay5NQwogICAgICBzZWxmLmhzSXAgPSBzZWxmLk1DLkV0aGVybmV0LklQQWRyCiAgICAgIHNlbGYuaHNQb3J0ID0gc2VsZi5NQy5FdGhlcm5ldC5JUFBvcnQKICAgICAgRU4gPSBsb2NhbHNbJ0VOJ10KICAgICAgc2VsZi5wb3J0ID0gaW50KEVOWzJdKQogICAgICBzZWxmLmFjY2Vzc1Rva2VuID0gRU5bM10KICAgICAgc2VsZi5pZCA9ICdBbWF6b25fRWNob19TZXJ2ZXInCiAgICAgIHNlbGYuc2VydmVyVGhyZWFkID0gTm9uZQogICAgICBzZWxmLmNlcnRUZXh0ID0gc2VsZi5nZXRTU0xDZXJ0KHNlbGYuaHNJcCwgc2VsZi5oc1BvcnQsIHNlbGYuRklMRU5BTUVfQ0VSVCkKICAgICAgc2VsZi5pbml0QXBwbGlhbmNlcygpCiAgICAgIEFtYXpvbkVjaG9XZWJDYWxsYmFjayhzZWxmLmxvZ2lrLCBzZWxmLndlYkNhbGxiYWNrU1NMQ2VydCwgc2VsZi5VUkxfU0hPV19TU0wpCiAgICAgIHNlbGYuaW5pdF9kZWJ1Z19lbnRyeSgpOwogICAgZGVmIHJlYWRBcHBsaWFuY2VzQ29uZihzZWxmKToKICAgICAgdHJ5OgogICAgICAgIGFwcGxpYW5jZXNDb25mID0gc2VsZi5sb2NhbHNbJ1NOJ11bMl0KICAgICAgICBzZWxmLmNvbmYgPSBqc29uLmxvYWRzKGFwcGxpYW5jZXNDb25mLCBlbmNvZGluZz0iaXNvODg1OS0xIikKICAgICAgZXhjZXB0OgogICAgICAgIHNlbGYuY29uZiA9IE5vbmUKICAgIGRlZiBzYXZlQXBwbGlhbmNlc0NvbmYoc2VsZiwgYXBwbGlhbmNlc0NvbmYpOgogICAgICBzZWxmLmxvZygiU2F2aW5nIGFwcGxpYW5jZXMgY29uZmlndXJhdGlvbi4iLCBzZXZlcml0eT0iaW5mbyIpCiAgICAgIG1zZyA9ICIiCiAgICAgIHRyeToKICAgICAgICBpZiBhcHBsaWFuY2VzQ29uZiAhPSAiIjoKICAgICAgICAgIHNlbGYuY29uZiA9IGpzb24ubG9hZHMoYXBwbGlhbmNlc0NvbmYsIGVuY29kaW5nPSJpc284ODU5LTEiKQogICAgICAgIGVsc2U6CiAgICAgICAgICBzZWxmLmNvbmYgPSBOb25lCiAgICAgICAgc2VsZi5sb2dpay5TcGVpY2hlcldlcnRbMV0gPSBhcHBsaWFuY2VzQ29uZgogICAgICAgIHNlbGYuTUMuU2ljaFF1ZXVlLnB1dChbMTAwLCBzZWxmLmxvZ2lrLCBzZWxmLmxvZ2lrLlNwZWljaGVyV2VydF0pCiAgICAgIGV4Y2VwdDoKICAgICAgICBtc2cgPSAiRmFpbGVkIHRvIHBhcnNlIGFwcGxpYW5jZXMgY29uZmlndXJhdGlvbi4iCiAgICAgICAgc2VsZi5NQy5EZWJ1Zy5zZXRFcnIoc3lzLmV4Y19pbmZvKCksIG1zZykKICAgICAgcmV0dXJuIG1zZwogICAgZGVmIGluaXRBcHBsaWFuY2VzKHNlbGYpOgogICAgICBzZWxmLnJlYWRBcHBsaWFuY2VzQ29uZigpCiAgICAgIHNlbGYuYXBwbGlhbmNlcyA9IFtdCiAgICAgIGlmIHNlbGYuY29uZiBpcyBOb25lOgogICAgICAgIHNlbGYuZGlzY292ZXJBcHBsaWFuY2VzKCkKICAgIGRlZiBkaXNjb3ZlckFwcGxpYW5jZXMoc2VsZik6CiAgICAgIGltcG9ydCByZQogICAgICByZWdleCA9IHJlLmNvbXBpbGUoIiguKilcW1xzKihTd2l0Y2hhYmxlfExpZ2h0aW5nKVxzKlxdXHMqJCIpCiAgICAgIGZvciBpa28gaW4gc2VsZi5NQy5UYWdMaXN0LlRhZ0xpc3Q6IAogICAgICAgIGtvID0gc2VsZi5NQy5UYWdMaXN0LlRhZ0xpc3RbaWtvXQogICAgICAgIG1hdGNoID0gcmVnZXguc2VhcmNoKGtvLlJQQ1RleHQpCiAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICBhcHBsaWFuY2UgPSBBbWF6b25FY2hvLktOWEFwcGxpYW5jZShrbywgbWF0Y2guZ3JvdXBzKClbMF0uc3RyaXAoKSwgbWF0Y2guZ3JvdXBzKClbMV0pCiAgICAgICAgICBzZWxmLmFwcGxpYW5jZXMuYXBwZW5kKGFwcGxpYW5jZSkKICAgIGNsYXNzIEtOWEFwcGxpYW5jZSgpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwga28sIGZyaWVuZGx5TmFtZSwgdHlwZSk6CiAgICAgICAgc2VsZi5rbyA9IGtvCiAgICAgICAgc2VsZi5mcmllbmRseU5hbWUgPSBmcmllbmRseU5hbWUKICAgICAgICBzZWxmLnR5cGUgPSB0eXBlCiAgICBkZWYgZGlzY292ZXJ5KHNlbGYsIG1lc3NhZ2VJZCk6CiAgICAgIHJlc3BvbnNlT2JqZWN0ID0gQW1hem9uRWNoby5EaXNjb3ZlcnlSZXNwb25zZShtZXNzYWdlSWQpCiAgICAgIGlmIHNlbGYuY29uZiBpcyBub3QgTm9uZToKICAgICAgICBpZCA9IDAKICAgICAgICBmb3IgZGV2aWNlIGluIHNlbGYuY29uZjoKICAgICAgICAgIHJvb20gPSBkZXZpY2UuZ2V0KCdyb29tJykKICAgICAgICAgIGlkICs9IDEKICAgICAgICAgIGlkU3RyID0gc3RyKGlkKQogICAgICAgICAgamQgPSAwCiAgICAgICAgICBmb3IgYXBwbGlhbmNlIGluIGRldmljZS5nZXQoJ2FwcGxpYW5jZXMnKToKICAgICAgICAgICAgamQgKz0gMQogICAgICAgICAgICB0eXBlID0gJ1N3aXRjaGFibGUnCiAgICAgICAgICAgIHBlcmNlbnQgPSBhcHBsaWFuY2UuZ2V0KCdwZXJjZW50Jyk7CiAgICAgICAgICAgIGlmIHBlcmNlbnQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgdHlwZSA9ICdMaWdodGluZycKICAgICAgICAgICAgaWYgcm9vbSBpcyBub3QgTm9uZSBhbmQgcm9vbSAhPSAiIjoKICAgICAgICAgICAgICBpZiBqZCA9PSAxOgogICAgICAgICAgICAgICAgZGlzY292ZXJ5QXBwbGlhbmNlID0gQW1hem9uRWNoby5EaXNjb3ZlcnlBcHBsaWFuY2UoaWRTdHIsIHJvb20sIHR5cGUpCiAgICAgICAgICAgICAgICByZXNwb25zZU9iamVjdC5hZGRBcHBsaWFuY2UoZGlzY292ZXJ5QXBwbGlhbmNlKQogICAgICAgICAgICAgIG5hbWUgPSBhcHBsaWFuY2UuZ2V0KCduYW1lJykKICAgICAgICAgICAgICBpZiBuYW1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBuYW1lID0gcm9vbQogICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBuYW1lID0gcm9vbSArICIgIiArIG5hbWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICBuYW1lID0gYXBwbGlhbmNlLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgaWYgbmFtZSBpcyBOb25lOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZGlzY292ZXJ5QXBwbGlhbmNlID0gQW1hem9uRWNoby5EaXNjb3ZlcnlBcHBsaWFuY2UoaWRTdHIgKyAiXyIgKyBzdHIoamQpLCBuYW1lLCB0eXBlKQogICAgICAgICAgICByZXNwb25zZU9iamVjdC5hZGRBcHBsaWFuY2UoZGlzY292ZXJ5QXBwbGlhbmNlKQogICAgICAgICAgICBhbGlhc2VzID0gYXBwbGlhbmNlLmdldCgnYWxpYXNlcycpOwogICAgICAgICAgICBpZiBhbGlhc2VzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgIGZvciBhbGlhcyBpbiBhbGlhc2VzOgogICAgICAgICAgICAgICAgamQgKz0gMQogICAgICAgICAgICAgICAgZGlzY292ZXJ5QXBwbGlhbmNlID0gQW1hem9uRWNoby5EaXNjb3ZlcnlBcHBsaWFuY2UoaWRTdHIgKyAiXyIgKyBzdHIoamQpLCBhbGlhcywgdHlwZSkKICAgICAgICAgICAgICAgIHJlc3BvbnNlT2JqZWN0LmFkZEFwcGxpYW5jZShkaXNjb3ZlcnlBcHBsaWFuY2UpCiAgICAgIGVsc2U6CiAgICAgICAgZm9yIGFwcGxpYW5jZSBpbiBzZWxmLmFwcGxpYW5jZXM6CiAgICAgICAgICBrbyA9IGFwcGxpYW5jZS5rbwogICAgICAgICAgZGlzY292ZXJ5QXBwbGlhbmNlID0gQW1hem9uRWNoby5EaXNjb3ZlcnlBcHBsaWFuY2Uoc3RyKGtvLklEKSwgYXBwbGlhbmNlLmZyaWVuZGx5TmFtZSwgYXBwbGlhbmNlLnR5cGUpCiAgICAgICAgICByZXNwb25zZU9iamVjdC5hZGRBcHBsaWFuY2UoZGlzY292ZXJ5QXBwbGlhbmNlKQogICAgICByZXR1cm4gcmVzcG9uc2VPYmplY3QKICAgIGRlZiBjb250cm9sKHNlbGYsIG1lc3NhZ2VJZCwgYXBwbGlhbmNlSWQsIHJlcXVlc3QsIHZhbHVlKToKICAgICAgcmVzcG9uc2VPYmplY3QgPSBBbWF6b25FY2hvLkNvbnRyb2xSZXNwb25zZShtZXNzYWdlSWQpCiAgICAgIHJlc3BvbnNlT2JqZWN0LnNldE5hbWUoIlVuc3VwcG9ydGVkT3BlcmF0aW9uRXJyb3IiKQogICAgICBhcHBsaWFuY2UgPSBzZWxmLmZpbmRBcHBsaWFuY2UoYXBwbGlhbmNlSWQpCiAgICAgIGlmIGFwcGxpYW5jZSBpcyBub3QgTm9uZToKICAgICAgICBvblZhbHVlID0gMS4wCiAgICAgICAgb2ZmVmFsdWUgPSAwLjAKICAgICAgICBpZiB0eXBlKGFwcGxpYW5jZSkgaXMgbm90IEFtYXpvbkVjaG8uS05YQXBwbGlhbmNlOgogICAgICAgICAgb25PZmYgPSBhcHBsaWFuY2UuZ2V0KCdvbk9mZicpCiAgICAgICAgICBwZXJjZW50ID0gYXBwbGlhbmNlLmdldCgncGVyY2VudCcpOwogICAgICAgICAgaWYgb25PZmYgaXMgTm9uZSBhbmQgcGVyY2VudCBpcyBOb25lOgogICAgICAgICAgICByZXNwb25zZU9iamVjdC5zZXROYW1lKCJOb1N1Y2hUYXJnZXRFcnJvciIpCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZU9iamVjdAogICAgICAgICAgb25PZmZLbyA9IE5vbmUKICAgICAgICAgIHBlcmNlbnRLbyA9IE5vbmUKICAgICAgICAgIGlmIG9uT2ZmIGlzIG5vdCBOb25lOgogICAgICAgICAgICBvbk9mZktvID0gc2VsZi5maW5kS28ob25PZmYpCiAgICAgICAgICBpZiBwZXJjZW50IGlzIG5vdCBOb25lOgogICAgICAgICAgICBhcHBsaWFuY2VUeXBlID0gIkxpZ2h0aW5nIgogICAgICAgICAgICBwZXJjZW50S28gPSBzZWxmLmZpbmRLbyhwZXJjZW50KQogICAgICAgICAgZWxzZToKICAgICAgICAgICAgYXBwbGlhbmNlVHlwZSA9ICJTd2l0Y2hhYmxlIgogICAgICAgICAgYXBwbGlhbmNlVmFsdWUgPSBhcHBsaWFuY2UuZ2V0KCd2YWx1ZScpCiAgICAgICAgICBpZiBhcHBsaWFuY2VWYWx1ZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgb25WYWx1ZSA9IGFwcGxpYW5jZVZhbHVlCiAgICAgICAgZWxzZToKICAgICAgICAgIGFwcGxpYW5jZVR5cGUgPSBhcHBsaWFuY2UudHlwZQogICAgICAgICAgb25PZmZLbyA9IHBlcmNlbnRLbyA9IGFwcGxpYW5jZS5rbwogICAgICAgICAgaWYgYXBwbGlhbmNlVHlwZSA9PSAiTGlnaHRpbmciOgogICAgICAgICAgICBvblZhbHVlID0gMTAwLjAKICAgICAgICBpZiBhcHBsaWFuY2VUeXBlID09ICJMaWdodGluZyI6CiAgICAgICAgICBpZiByZXF1ZXN0ID09ICdUdXJuT25SZXF1ZXN0JzoKICAgICAgICAgICAgc2VsZi5fS05YU2V0VmFsdWUob25PZmZLbywgb25WYWx1ZSwgIlR1cm5PbkNvbmZpcm1hdGlvbiIsIHJlc3BvbnNlT2JqZWN0KQogICAgICAgICAgZWxpZiByZXF1ZXN0ID09ICdUdXJuT2ZmUmVxdWVzdCc6CiAgICAgICAgICAgIHNlbGYuX0tOWFNldFZhbHVlKG9uT2ZmS28sIG9mZlZhbHVlLCAiVHVybk9mZkNvbmZpcm1hdGlvbiIsIHJlc3BvbnNlT2JqZWN0KQogICAgICAgICAgZWxpZiByZXF1ZXN0ID09ICdTZXRQZXJjZW50YWdlUmVxdWVzdCc6CiAgICAgICAgICAgIHNlbGYuX0tOWFNldFBlcmNlbnQocGVyY2VudEtvLCB2YWx1ZSwgIlNldFBlcmNlbnRhZ2VDb25maXJtYXRpb24iLCByZXNwb25zZU9iamVjdCkKICAgICAgICAgIGVsaWYgcmVxdWVzdCA9PSAnSW5jcmVtZW50UGVyY2VudGFnZVJlcXVlc3QnOgogICAgICAgICAgICBzZWxmLl9LTlhBZGRQZXJjZW50KHBlcmNlbnRLbywgdmFsdWUsIDEsICJJbmNyZW1lbnRQZXJjZW50YWdlQ29uZmlybWF0aW9uIiwgcmVzcG9uc2VPYmplY3QpCiAgICAgICAgICBlbGlmIHJlcXVlc3QgPT0gJ0RlY3JlbWVudFBlcmNlbnRhZ2VSZXF1ZXN0JzoKICAgICAgICAgICAgc2VsZi5fS05YQWRkUGVyY2VudChwZXJjZW50S28sIHZhbHVlLCAtMSwgIkRlY3JlbWVudFBlcmNlbnRhZ2VDb25maXJtYXRpb24iLCByZXNwb25zZU9iamVjdCkKICAgICAgICBlbGlmIGFwcGxpYW5jZVR5cGUgPT0gIlN3aXRjaGFibGUiOgogICAgICAgICAgaWYgcmVxdWVzdCA9PSAnVHVybk9uUmVxdWVzdCc6CiAgICAgICAgICAgIHNlbGYuX0tOWFNldFZhbHVlKG9uT2ZmS28sIG9uVmFsdWUsICJUdXJuT25Db25maXJtYXRpb24iLCByZXNwb25zZU9iamVjdCkKICAgICAgICAgIGVsaWYgcmVxdWVzdCA9PSAnVHVybk9mZlJlcXVlc3QnOgogICAgICAgICAgICBzZWxmLl9LTlhTZXRWYWx1ZShvbk9mZktvLCBvZmZWYWx1ZSwgIlR1cm5PZmZDb25maXJtYXRpb24iLCByZXNwb25zZU9iamVjdCkKICAgICAgICBlbHNlOgogICAgICAgICAgcmVzcG9uc2VPYmplY3Quc2V0TmFtZSgiVW5leHBlY3RlZEluZm9ybWF0aW9uUmVjZWl2ZWRFcnJvciIpCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2VPYmplY3Quc2V0TmFtZSgiTm9TdWNoVGFyZ2V0RXJyb3IiKQogICAgICByZXR1cm4gcmVzcG9uc2VPYmplY3QKICAgIGRlZiBfS05YQWRkUGVyY2VudChzZWxmLCBrbywgdmFsdWUsIHNpZ24sIG5hbWUsIHJlc3BvbnNlT2JqZWN0KToKICAgICAgdHJ5OgogICAgICAgIGZ2YWx1ZSA9IDAuMAogICAgICAgIGlmIGtvIGlzIG5vdCBOb25lOgogICAgICAgICAgZnZhbHVlID0ga28uZ2V0V2VydCgpICsgKHNpZ24gKiBmbG9hdCh2YWx1ZSkpCiAgICAgICAgICBpZiBmdmFsdWUgPCAwLjA6CiAgICAgICAgICAgIGZ2YWx1ZSA9IDAuMAogICAgICAgICAgZWxpZiBmdmFsdWUgPiAxMDAuMDoKICAgICAgICAgICAgZnZhbHVlID0gMTAwLjAKICAgICAgICBzZWxmLl9LTlhTZXRWYWx1ZShrbywgZnZhbHVlLCBuYW1lLCByZXNwb25zZU9iamVjdCkKICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcmVzcG9uc2VPYmplY3Quc2V0TmFtZSgiVW5zdXBwb3J0ZWRUYXJnZXRTZXR0aW5nRXJyb3IiKQogICAgZGVmIF9LTlhTZXRQZXJjZW50KHNlbGYsIGtvLCB2YWx1ZSwgbmFtZSwgcmVzcG9uc2VPYmplY3QpOgogICAgICB0cnk6CiAgICAgICAgZnZhbHVlID0gZmxvYXQodmFsdWUpCiAgICAgICAgaWYgZnZhbHVlID49IDAuMCBhbmQgZnZhbHVlIDw9IDEwMC4wOgogICAgICAgICAgc2VsZi5fS05YU2V0VmFsdWUoa28sIGZ2YWx1ZSwgbmFtZSwgcmVzcG9uc2VPYmplY3QpCiAgICAgICAgZWxzZToKICAgICAgICAgIHJlc3BvbnNlT2JqZWN0LnNldE5hbWUoIlZhbHVlT3V0T2ZSYW5nZUVycm9yIikKICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcmVzcG9uc2VPYmplY3Quc2V0TmFtZSgiVW5zdXBwb3J0ZWRUYXJnZXRTZXR0aW5nRXJyb3IiKQogICAgZGVmIF9LTlhTZXRWYWx1ZShzZWxmLCBrbywgZnZhbHVlLCBuYW1lLCByZXNwb25zZU9iamVjdCk6CiAgICAgIGlmIGtvIGlzIE5vbmU6CiAgICAgICAgcmVzcG9uc2VPYmplY3Quc2V0TmFtZSgiTm9TdWNoVGFyZ2V0RXJyb3IiKQogICAgICAgIHJldHVybgogICAgICBzZWxmLmxvZ2lrLk1DLlRhZ0xpc3Quc2V0V2VydChGTEFHX0VJQl9MT0dJSywga28sIGZ2YWx1ZSkKICAgICAgcmVzcG9uc2VPYmplY3Quc2V0TmFtZShuYW1lKQogICAgZGVmIGZpbmRBcHBsaWFuY2Uoc2VsZiwgYXBwbGlhbmNlSWQpOgogICAgICBpZiBzZWxmLmNvbmYgaXMgbm90IE5vbmU6CiAgICAgICAgaWQgPSAwCiAgICAgICAgZm9yIGRldmljZSBpbiBzZWxmLmNvbmY6CiAgICAgICAgICByb29tID0gZGV2aWNlLmdldCgncm9vbScpCiAgICAgICAgICBpZCArPSAxCiAgICAgICAgICBpZFN0ciA9IHN0cihpZCkKICAgICAgICAgIGlmIGFwcGxpYW5jZUlkID09IGlkU3RyOgogICAgICAgICAgICByZXR1cm4gZGV2aWNlWydhcHBsaWFuY2VzJ11bMF0KICAgICAgICAgIGpkID0gMAogICAgICAgICAgZm9yIGFwcGxpYW5jZSBpbiBkZXZpY2VbJ2FwcGxpYW5jZXMnXToKICAgICAgICAgICAgamQgKz0gMQogICAgICAgICAgICBpZiBhcHBsaWFuY2VJZCA9PSBpZFN0ciArICJfIiArIHN0cihqZCk6CiAgICAgICAgICAgICAgcmV0dXJuIGFwcGxpYW5jZQogICAgICAgICAgICBhbGlhc2VzID0gYXBwbGlhbmNlLmdldCgnYWxpYXNlcycpOwogICAgICAgICAgICBpZiBhbGlhc2VzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgIGZvciBhbGlhcyBpbiBhbGlhc2VzOgogICAgICAgICAgICAgICAgamQgKz0gMQogICAgICAgICAgICAgICAgaWYgYXBwbGlhbmNlSWQgPT0gaWRTdHIgKyAiXyIgKyBzdHIoamQpOgogICAgICAgICAgICAgICAgICByZXR1cm4gYXBwbGlhbmNlCiAgICAgIGVsc2U6CiAgICAgICAgZm9yIGFwcGxpYW5jZSBpbiBzZWxmLmFwcGxpYW5jZXM6CiAgICAgICAgICBrbyA9IGFwcGxpYW5jZS5rbwogICAgICAgICAgaWYgc3RyKGtvLklEKSA9PSBhcHBsaWFuY2VJZDoKICAgICAgICAgICAgcmV0dXJuIGFwcGxpYW5jZQogICAgICByZXR1cm4gTm9uZQogICAgZGVmIGZpbmRLbyhzZWxmLCBncnBBZHJTdHIpOgogICAgICBmb3IgaWtvIGluIHNlbGYuTUMuVGFnTGlzdC5UYWdMaXN0OiAKICAgICAgICBrbyA9IHNlbGYuTUMuVGFnTGlzdC5UYWdMaXN0W2lrb10KICAgICAgICBpZiBrby5HcnBBZHJTdHIgPT0gZ3JwQWRyU3RyOgogICAgICAgICAgcmV0dXJuIGtvCiAgICAgIHJldHVybiBOb25lOwogICAgY2xhc3MgSGVhZGVyKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBtZXNzYWdlSWQsIG5hbWUsIG5hbWVzcGFjZSwgcGF5bG9hZFZlcnNpb24pOgogICAgICAgIHNlbGYubWVzc2FnZUlkID0gbWVzc2FnZUlkCiAgICAgICAgc2VsZi5uYW1lID0gbmFtZQogICAgICAgIHNlbGYubmFtZXNwYWNlID0gbmFtZXNwYWNlCiAgICAgICAgc2VsZi5wYXlsb2FkVmVyc2lvbiA9IHBheWxvYWRWZXJzaW9uCiAgICBjbGFzcyBDb250cm9sUmVzcG9uc2UoKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIG1lc3NhZ2VJZCk6CiAgICAgICAgc2VsZi5oZWFkZXIgPSBBbWF6b25FY2hvLkhlYWRlcihtZXNzYWdlSWQsICIiLCAiQWxleGEuQ29ubmVjdGVkSG9tZS5Db250cm9sIiwgIjIiKQogICAgICAgIHNlbGYucGF5bG9hZCA9IHt9CiAgICAgIGRlZiBzZXROYW1lKHNlbGYsIG5hbWUpOgogICAgICAgIHNlbGYuaGVhZGVyLm5hbWUgPSBuYW1lCiAgICBjbGFzcyBEaXNjb3ZlcnlSZXNwb25zZSgpOgogICAgICBkZWYgX19pbml0X18oc2VsZiwgbWVzc2FnZUlkKToKICAgICAgICBzZWxmLmhlYWRlciA9IEFtYXpvbkVjaG8uSGVhZGVyKG1lc3NhZ2VJZCwgIkRpc2NvdmVyQXBwbGlhbmNlc1Jlc3BvbnNlIiwgIkFsZXhhLkNvbm5lY3RlZEhvbWUuRGlzY292ZXJ5IiwgIjIiKQogICAgICAgIHNlbGYucGF5bG9hZCA9IEFtYXpvbkVjaG8uRGlzY292ZXJ5UGF5bG9hZCgpCiAgICAgIGRlZiBzZXROYW1lKHNlbGYsIG5hbWUpOgogICAgICAgIHNlbGYuaGVhZGVyLm5hbWUgPSBuYW1lCiAgICAgIGRlZiBhZGRBcHBsaWFuY2Uoc2VsZiwgYXBwbGlhbmNlKToKICAgICAgICBzZWxmLnBheWxvYWQuZGlzY292ZXJlZEFwcGxpYW5jZXMuYXBwZW5kKGFwcGxpYW5jZSkKICAgIGNsYXNzIERpc2NvdmVyeVBheWxvYWQoKToKICAgICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuZGlzY292ZXJlZEFwcGxpYW5jZXMgPSBbXQogICAgY2xhc3MgRGlzY292ZXJ5QXBwbGlhbmNlKCk6CiAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhcHBsaWFuY2VJZCwgZnJpZW5kbHlOYW1lLCBhcHBsaWFuY2VUeXBlKToKICAgICAgICBzZWxmLmFwcGxpYW5jZUlkID0gYXBwbGlhbmNlSWQKICAgICAgICBzZWxmLmZyaWVuZGx5RGVzY3JpcHRpb24gPSBmcmllbmRseU5hbWUKICAgICAgICBzZWxmLmZyaWVuZGx5TmFtZSA9IGZyaWVuZGx5TmFtZQogICAgICAgIHNlbGYuaXNSZWFjaGFibGUgPSBUcnVlCiAgICAgICAgc2VsZi5tYW51ZmFjdHVyZXJOYW1lID0gIm4uYS4iCiAgICAgICAgc2VsZi5tb2RlbE5hbWUgPSAibi5hLiIKICAgICAgICBzZWxmLnZlcnNpb24gPSAiMS4wIgogICAgICAgIGlmIGFwcGxpYW5jZVR5cGUgPT0gIlN3aXRjaGFibGUiOgogICAgICAgICAgc2VsZi5hY3Rpb25zID0gWyJ0dXJuT24iLCAidHVybk9mZiJdCiAgICAgICAgZWxpZiBhcHBsaWFuY2VUeXBlID09ICJMaWdodGluZyI6CiAgICAgICAgICBzZWxmLmFjdGlvbnMgPSBbInR1cm5PbiIsICJ0dXJuT2ZmIiwgImluY3JlbWVudFBlcmNlbnRhZ2UiLCAiZGVjcmVtZW50UGVyY2VudGFnZSIsICJzZXRQZXJjZW50YWdlIl0KICAgICAgICBlbGlmIGFwcGxpY2FuY2VUeXBlID09ICJUaGVybW9zdGF0IjoKICAgICAgICAgIHNlbGYuYWN0aW9ucyA9IFsiaW5jcmVtZW50VGFyZ2V0VGVtcGVyYXR1cmUiLCAiZGVjcmVtZW50VGFyZ2V0VGVtcGVyYXR1cmUiLCAic2V0VGFyZ2V0VGVtcGVyYXR1cmUiXQogICAgY2xhc3MgSFRUUFJlcXVlc3RIYW5kbGVyKEJhc2VIVFRQUmVxdWVzdEhhbmRsZXIpOgogICAgICBkZWYgYWRkcmVzc19zdHJpbmcoc2VsZik6CiAgICAgICAgICBob3N0LCBwb3J0ID0gc2VsZi5jbGllbnRfYWRkcmVzc1s6Ml0KICAgICAgICAgIHJldHVybiBob3N0CiAgICAgIGRlZiBsb2dfcmVxdWVzdChzZWxmLCBjb2RlPU5vbmUsIHNpemU9Tm9uZSk6CiAgICAgICAgcGFzcwogICAgICBkZWYgbG9nX21lc3NhZ2Uoc2VsZiwgZm9ybWF0LCAqYXJncyk6CiAgICAgICAgcGFzcwogICAgICBkZWYgZG9fUE9TVChzZWxmKToKICAgICAgICBzZWxmLnBvc3R2YXJzID0gc2VsZi5wYXJzZV9QT1NUKCkKICAgICAgICBzZWxmLmRvX1JFUSgpCiAgICAgIGRlZiBwYXJzZV9QT1NUKHNlbGYpOgogICAgICAgIGZyb20gY2dpIGltcG9ydCBwYXJzZV9oZWFkZXIsIHBhcnNlX211bHRpcGFydAogICAgICAgIGZyb20gdXJscGFyc2UgaW1wb3J0IHBhcnNlX3FzCiAgICAgICAgY3R5cGUsIHBkaWN0ID0gcGFyc2VfaGVhZGVyKHNlbGYuaGVhZGVyc1snY29udGVudC10eXBlJ10pCiAgICAgICAgaWYgY3R5cGUgPT0gJ211bHRpcGFydC9mb3JtLWRhdGEnOgogICAgICAgICAgICBwb3N0dmFycyA9IHBhcnNlX211bHRpcGFydChzZWxmLnJmaWxlLCBwZGljdCkKICAgICAgICBlbGlmIGN0eXBlID09ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOgogICAgICAgICAgICBsZW5ndGggPSBpbnQoc2VsZi5oZWFkZXJzWydjb250ZW50LWxlbmd0aCddKQogICAgICAgICAgICBwb3N0dmFycyA9IHBhcnNlX3FzKAogICAgICAgICAgICAgICAgICAgIHNlbGYucmZpbGUucmVhZChsZW5ndGgpLCAKICAgICAgICAgICAgICAgICAgICBrZWVwX2JsYW5rX3ZhbHVlcz0xKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHBvc3R2YXJzID0ge30KICAgICAgICByZXR1cm4gcG9zdHZhcnMKICAgICAgZGVmIGRvX0dFVChzZWxmKToKICAgICAgICBzZWxmLnBvc3R2YXJzID0gTm9uZQogICAgICAgIHNlbGYuZG9fUkVRKCkKICAgICAgZGVmIGRvX1JFUShzZWxmKToKICAgICAgICBhY2Nlc3NUb2tlbiA9IE5vbmUKICAgICAgICBtZXNzYWdlSWQgPSBOb25lCiAgICAgICAgdHJ5OgogICAgICAgICAgaWR4ID0gc2VsZi5wYXRoLmluZGV4KCI/IikKICAgICAgICAgIHNlbGYuY29tbWFuZCA9IHNlbGYucGF0aFsxOmlkeF0KICAgICAgICAgIHJlcVBhcmFtcyA9IHNlbGYuX2J1aWxkUmVxUGFyYW1NYXAoc2VsZi5wYXRoW2lkeCsxOl0pCiAgICAgICAgICBhY2Nlc3NUb2tlbiA9IHJlcVBhcmFtcy5nZXQoJ2FjY2Vzc1Rva2VuJykKICAgICAgICAgIG1lc3NhZ2VJZCA9IHJlcVBhcmFtcy5nZXQoJ21lc3NhZ2VJZCcpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICBzZWxmLmNvbW1hbmQgPSBzZWxmLnBhdGhbMTpdCiAgICAgICAgaWYgc2VsZi5jb21tYW5kID09ICdjb25maWcnOgogICAgICAgICAgaWYgYWNjZXNzVG9rZW4gIT0gc2VsZi5zZXJ2ZXIuYWNjZXNzVG9rZW46CiAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDEsICdNaXNzaW5nIG9yIGludmFsaWQgYWNjZXNzIHRva2VuJykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICBzZWxmLl9jb25maWcoKQogICAgICAgICAgcmV0dXJuCiAgICAgICAgaWYgbWVzc2FnZUlkIGlzIE5vbmU6CiAgICAgICAgICBzZWxmLl9zZW5kSnNvbkVycm9yUmVzcG9uc2UoIiIsICJVbmV4cGVjdGVkSW5mb3JtYXRpb25SZWNlaXZlZEVycm9yIikKICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGFjY2Vzc1Rva2VuIGlzIE5vbmU6CiAgICAgICAgICBzZWxmLl9zZW5kSnNvbkVycm9yUmVzcG9uc2UobWVzc2FnZUlkLCAiVW5leHBlY3RlZEluZm9ybWF0aW9uUmVjZWl2ZWRFcnJvciIpCiAgICAgICAgICByZXR1cm4KICAgICAgICBpZiBhY2Nlc3NUb2tlbiAhPSBzZWxmLnNlcnZlci5hY2Nlc3NUb2tlbjoKICAgICAgICAgIHNlbGYuX3NlbmRKc29uRXJyb3JSZXNwb25zZShtZXNzYWdlSWQsICJJbnZhbGlkQWNjZXNzVG9rZW5FcnJvciIpCiAgICAgICAgICByZXR1cm4KICAgICAgICBpZiBzZWxmLmNvbW1hbmQgPT0gJ2NvbnRyb2wnOgogICAgICAgICAgdHJ5OgogICAgICAgICAgICByZXF1ZXN0ID0gcmVxUGFyYW1zWydyZXF1ZXN0J10KICAgICAgICAgICAgYXBwbGlhbmNlSWQgPSByZXFQYXJhbXNbJ2FwcGxpYW5jZUlkJ10KICAgICAgICAgICAgdmFsdWUgPSByZXFQYXJhbXMuZ2V0KCd2YWx1ZScsIE5vbmUpCiAgICAgICAgICBleGNlcHQgKEtleUVycm9yKToKICAgICAgICAgICAgc2VsZi5fc2VuZEpzb25FcnJvclJlc3BvbnNlKG1lc3NhZ2VJZCwgIlVuZXhwZWN0ZWRJbmZvcm1hdGlvblJlY2VpdmVkRXJyb3IiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIHJlc3BvbnNlT2JqZWN0ID0gc2VsZi5zZXJ2ZXIuY29udHJvbChtZXNzYWdlSWQsIGFwcGxpYW5jZUlkLCByZXF1ZXN0LCB2YWx1ZSkKICAgICAgICAgIHNlbGYuX3NlbmRKc29uUmVzcG9uc2UocmVzcG9uc2VPYmplY3QpCiAgICAgICAgZWxpZiBzZWxmLmNvbW1hbmQgPT0gJ2Rpc2NvdmVyeSc6CiAgICAgICAgICByZXNwb25zZU9iamVjdCA9IHNlbGYuc2VydmVyLmRpc2NvdmVyeShtZXNzYWdlSWQpCiAgICAgICAgICBzZWxmLl9zZW5kSnNvblJlc3BvbnNlKHJlc3BvbnNlT2JqZWN0KQogICAgICAgIGVsc2U6CiAgICAgICAgICBzZWxmLl9zZW5kSnNvbkVycm9yUmVzcG9uc2UobWVzc2FnZUlkLCAiVW5leHBlY3RlZEluZm9ybWF0aW9uUmVjZWl2ZWRFcnJvciIpCiAgICAgIGRlZiBfY29uZmlnKHNlbGYpOgogICAgICAgIG1zZyA9ICIiCiAgICAgICAgaWYgc2VsZi5wb3N0dmFycyBpcyBub3QgTm9uZToKICAgICAgICAgIGNvbmZMaXN0ID0gc2VsZi5wb3N0dmFycy5nZXQoJ2NvbmYnLCBOb25lKQogICAgICAgICAgaWYgY29uZkxpc3QgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIG1zZyA9IHNlbGYuc2VydmVyLnNhdmVBcHBsaWFuY2VzQ29uZihjb25mTGlzdFswXS5zdHJpcCgpKQogICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC1UeXBlJywgJ3RleHQvaHRtbDsgY2hhcnNldD1JU08tODg1OS0xJykKICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICBzZWxmLndmaWxlLndyaXRlKCI8aHRtbD48aGVhZD48bWV0YSBjaGFyc2V0PSdJU08tODg1OS0xJz48L2hlYWQ+PGJvZHk+IikKICAgICAgICBzZWxmLndmaWxlLndyaXRlKCI8Zm9ybSBtZXRob2Q9J3Bvc3QnIGVuY3R5cGU9J2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgYWNjZXB0LWNoYXJzZXQ9J0lTTy04ODU5LTEnPiIpCiAgICAgICAgc2VsZi53ZmlsZS53cml0ZSgiPHRhYmxlIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlJz48dHI+PHRkPjxoMT5BbWF6b24gRWNobyAtIEFwcGxpYW5jZXM8L2gxPjwvdGQ+PC90cj4iKQogICAgICAgIHNlbGYud2ZpbGUud3JpdGUoIjx0ciBzdHlsZT0naGVpZ2h0Ojk5JSc+PHRkPjx0ZXh0YXJlYSBuYW1lPSdjb25mJyBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJSc+IikKICAgICAgICBpZiBzZWxmLnNlcnZlci5jb25mIGlzIG5vdCBOb25lOgogICAgICAgICAgcmVzcCA9IGpzb24uZHVtcHMoc2VsZi5zZXJ2ZXIuY29uZiwgZGVmYXVsdD1hc0RpY3QsIGVuY29kaW5nPSJpc284ODU5LTEiKQogICAgICAgIGVsc2U6CiAgICAgICAgICByZXNwID0gIiIKICAgICAgICBzZWxmLndmaWxlLndyaXRlKHJlc3ApCiAgICAgICAgc2VsZi53ZmlsZS53cml0ZSgiPC90ZXh0YXJlYT48L3RkPjwvdHI+IikKICAgICAgICBzZWxmLndmaWxlLndyaXRlKCI8dHI+PHRkPjxpbnB1dCB0eXBlPSdzdWJtaXQnLz48L3RkPjwvdHI+IikKICAgICAgICBzZWxmLndmaWxlLndyaXRlKCI8dHI+PHRkIHN0eWxlPSdjb2xvcjpyZWQnPiIgKyBtc2cgKyAiPC90ZD48L3RyPiIpCiAgICAgICAgc2VsZi53ZmlsZS53cml0ZSgiPC9mb3JtPjwvYm9keT48L2h0bWw+IikKICAgICAgZGVmIF9zZW5kSnNvbkVycm9yUmVzcG9uc2Uoc2VsZiwgbWVzc2FnZUlkLCBlcnJvck1lc3NhZ2UpOgogICAgICAgIHJlc3BvbnNlT2JqZWN0ID0gTm9uZQogICAgICAgIGlmIHNlbGYuY29tbWFuZCA9PSAnY29udHJvbCc6CiAgICAgICAgICByZXNwb25zZU9iamVjdCA9IEFtYXpvbkVjaG8uQ29udHJvbFJlc3BvbnNlKG1lc3NhZ2VJZCkKICAgICAgICBlbGlmIHNlbGYuY29tbWFuZCA9PSAnZGlzY292ZXJ5JzoKICAgICAgICAgIHJlc3BvbnNlT2JqZWN0ID0gQW1hem9uRWNoby5EaXNjb3ZlcnlSZXNwb25zZShtZXNzYWdlSWQpCiAgICAgICAgZWxzZToKICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDQsICdOb3QgRm91bmQnKQogICAgICAgICAgcmV0dXJuCiAgICAgICAgcmVzcG9uc2VPYmplY3Quc2V0TmFtZShlcnJvck1lc3NhZ2UpCiAgICAgICAgc2VsZi5fc2VuZEpzb25SZXNwb25zZShyZXNwb25zZU9iamVjdCkKICAgICAgZGVmIF9zZW5kSnNvblJlc3BvbnNlKHNlbGYsIHJlc3BvbnNlT2JqZWN0KToKICAgICAgICByZXNwID0ganNvbi5kdW1wcyhyZXNwb25zZU9iamVjdCwgZGVmYXVsdD1hc0RpY3QsIGVuY29kaW5nPSJpc284ODU5LTEiKQogICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAgc2VsZi5zZW5kX2hlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnKQogICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgIHNlbGYud2ZpbGUud3JpdGUocmVzcCkKICAgICAgZGVmIF9idWlsZFJlcVBhcmFtTWFwKHNlbGYsIHF1ZXJ5KToKICAgICAgICBpbXBvcnQgdXJsbGliCiAgICAgICAgcmVxX3BhcmFtcyA9IHt9CiAgICAgICAgcGFyYW1zID0gcXVlcnkuc3BsaXQoJyYnKQogICAgICAgIGZvciBwYXJhbSBpbiBwYXJhbXM6CiAgICAgICAgICBpZHggPSBwYXJhbS5maW5kKCc9JykKICAgICAgICAgIHJlcV9wYXJhbXNbcGFyYW1bMDppZHhdXSA9IHVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1baWR4ICsgMTpdKQogICAgICAgIHJldHVybiByZXFfcGFyYW1zCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgIHNlbGYubG9nKCJTdGFydCAiLCBzZXZlcml0eT0iaW5mbyIpCiAgICAgIGlmIHNlbGYuc2VydmVyVGhyZWFkIGlzIE5vbmU6CiAgICAgICAgSFRUUFNlcnZlci5fX2luaXRfXyhzZWxmLCAoc2VsZi5oc0lwLCBzZWxmLnBvcnQpLCBzZWxmLkhUVFBSZXF1ZXN0SGFuZGxlcikKICAgICAgICBpZiBzZWxmLmNlcnRUZXh0ICE9ICIiOgogICAgICAgICAgd2l0aCBvcGVuKHNlbGYuRklMRVBBVEhfQ0VSVCwgIndiIikgYXMgb3V0cHV0OgogICAgICAgICAgICBvdXRwdXQud3JpdGUoc2VsZi5jZXJ0VGV4dCkKICAgICAgICAgIGltcG9ydCBzc2wKICAgICAgICAgIHNlbGYuc29ja2V0ID0gc3NsLndyYXBfc29ja2V0KHNlbGYuc29ja2V0LCBjZXJ0ZmlsZT1zZWxmLkZJTEVQQVRIX0NFUlQsIHNlcnZlcl9zaWRlPVRydWUpCiAgICAgICAgZnJvbSBoc19xdWV1ZSBpbXBvcnQgaHNfdGhyZWFkaW5nIGFzIHRocmVhZGluZwogICAgICAgIHNlbGYuc2VydmVyVGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5zZXJ2ZV9mb3JldmVyLCBuYW1lPSdhbWF6b25fZWNob19zZXJ2ZXInKQogICAgICAgIHNlbGYuc2VydmVyVGhyZWFkLmRhZW1vbiA9IFRydWUKICAgICAgICBzZWxmLnNlcnZlclRocmVhZC5zdGFydCgpCiAgICBkZWYgc3RvcChzZWxmKToKICAgICAgc2VsZi5sb2coIlN0b3AgIiwgc2V2ZXJpdHk9ImluZm8iKQogICAgICBpZiBub3Qgc2VsZi5zZXJ2ZXJUaHJlYWQgaXMgTm9uZToKICAgICAgICBIVFRQU2VydmVyLnNodXRkb3duKHNlbGYpCiAgICAgICAgc2VsZi5zb2NrZXQuY2xvc2UoKQogICAgICAgIHNlbGYuc2VydmVyVGhyZWFkID0gTm9uZQogICAgZGVmIGdldFNTTENlcnQoc2VsZiwgaXAsIHBvcnQsIGNlcnRGaWxlbmFtZSk6CiAgICAgIGlmIEhTOgogICAgICAgIHRyeToKICAgICAgICAgIGltcG9ydCB1cmxsaWIyCiAgICAgICAgICB1cmwgPSAiaHR0cDovL3swfTp7MX0vb3B0L3syfSIuZm9ybWF0KGlwLCBwb3J0LCBjZXJ0RmlsZW5hbWUpCiAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQogICAgICAgICAgcmVzID0gdXJsbGliMi51cmxvcGVuKHJlcSkKICAgICAgICAgIGlmIHJlcy5nZXRjb2RlKCkgPT0gMjAwOgogICAgICAgICAgICByZXR1cm4gcmVzLmZwLnJlYWQoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgIHBhc3MKICAgICAgZWxzZToKICAgICAgICB3aXRoIG9wZW4oJ2FtYXpvbkVjaG9TU0wuY2VydCcsICdyJykgYXMgbXlmaWxlOgogICAgICAgICAgY2VydFRleHQ9bXlmaWxlLnJlYWQoKQogICAgICAgIHJldHVybiBjZXJ0VGV4dAogICAgICByZXR1cm4gIiIKICAgIGRlZiB3ZWJDYWxsYmFja1NTTENlcnQoc2VsZiwgc3RyZWFtPUZhbHNlKToKICAgICAgaHRtbCA9ICI8aHRtbD48aGVhZD4iCiAgICAgIGh0bWwgKz0gIjxtZXRhIGNoYXJzZXQ9J0lTTy04ODU5LTEnLz4iCiAgICAgIGh0bWwgKz0gIjxtZXRhIGh0dHAtZXF1aXY9J2NhY2hlLWNvbnRyb2wnIGNvbnRlbnQ9J21heC1hZ2U9MCcvPiIKICAgICAgaHRtbCArPSAiPG1ldGEgaHR0cC1lcXVpdj0nY2FjaGUtY29udHJvbCcgY29udGVudD0nbm8tY2FjaGUnLz4iCiAgICAgIGh0bWwgKz0gIjxtZXRhIGh0dHAtZXF1aXY9J2V4cGlyZXMnIGNvbnRlbnQ9JzAnLz4iCiAgICAgIGh0bWwgKz0gIjxtZXRhIGh0dHAtZXF1aXY9J2V4cGlyZXMnIGNvbnRlbnQ9J1R1ZSwgMDEgSmFuIDE5ODAgMTowMDowMCBHTVQnLz4iCiAgICAgIGh0bWwgKz0gIjxtZXRhIGh0dHAtZXF1aXY9J3ByYWdtYScgY29udGVudD0nbm8tY2FjaGUnLz4iCiAgICAgIGh0bWwgKz0gIjwvaGVhZD48Ym9keT4iCiAgICAgIGh0bWwgKz0gIjxoMT5BbWF6b24gRWNobyAtIFNTTCBDZXJ0aWZpY2F0ZTwvaDE+IgogICAgICBodG1sICs9ICI8cHJlPjxjb2RlPiIKICAgICAgaHRtbCArPSBzZWxmLmNlcnRUZXh0CiAgICAgIGh0bWwgKz0gIjwvcHJlPjwvY29kZT4iCiAgICAgIGh0bWwgKz0gIjwvYm9keT48L2h0bWw+IgogICAgICBpZiBzdHJlYW06CiAgICAgICAgICBzdHJlYW0ud3JpdGUoaHRtbCkKICAgICAgc2VsZi5EYXRMZW4gPSBsZW4oaHRtbCkKICAgIGRlZiBpbml0X2RlYnVnX2VudHJ5KHNlbGYpOgogICAgICBwcm90byA9ICJodHRwIgogICAgICBpZiBzZWxmLmNlcnRUZXh0ICE9ICIiOgogICAgICAgIHByb3RvID0gImh0dHBzIgogICAgICBpbXBvcnQgdXJsbGliCiAgICAgIHNlbGYuTUMuRGVidWcuYWRkR3J1cHBlKAogICAgICAgIFtzZWxmLmlkLCBzZWxmLmlkXSwKICAgICAgICAgIFsgCiAgICAgICAgICAgIFsiMFZFUlNJT05JTkZPIiwiVmVyc2lvbiIsMSwnVjAuMSAtICgyMDE2LTEyLTA2IDEyOjI2KSddLAogICAgICAgICAgICBbIjFQT1JUIiwiUG9ydCIsMSxzdHIoc2VsZi5wb3J0KV0sCiAgICAgICAgICAgIFsiMlNTTCIsIlNTTC1DZXJ0aWZpY2F0ZSIsMSwiPGEgaHJlZj0nL29wdC97MH0nPnNob3c8L2E+PGJyPiIuZm9ybWF0KHNlbGYuVVJMX1NIT1dfU1NMKV0sCiAgICAgICAgICAgIFsiM0NPTkZJRyIsIkFwcGxpYW5jZXMgY29uZmlndXJhdGlvbiIsMSwiPGEgaHJlZj0nezB9Oi8vezF9OnsyfS9jb25maWc/YWNjZXNzVG9rZW49ezN9Jz5lZGl0PC9hPjxicj4iLmZvcm1hdChwcm90bywgc2VsZi5oc0lwLCBzZWxmLnBvcnQsIHVybGxpYi5xdW90ZV9wbHVzKHNlbGYuYWNjZXNzVG9rZW4pKV0sCiAgICAgICAgICBdICAgCiAgICAgICkKICAgIGRlZiBkZWJ1ZyhzZWxmLCBtc2csIGx2bD01KToKICAgICAgaW1wb3J0IHRpbWUKICAgICAgc2VsZi5sb2cobXNnLCBzZXZlcml0eT0nZGVidWcnKQogICAgICBwcmludCAiJXMgREVCVUc6ICVyIiAlICh0aW1lLnN0cmZ0aW1lKCIlSDolTTolUyIpLCBtc2csICkKICAgIGRlZiBsb2coc2VsZiwgbXNnLCBzZXZlcml0eT0naW5mbycpOgogICAgICBpbXBvcnQgdGltZQogICAgICBmcm9tIGhhc2hsaWIgaW1wb3J0IG1kNQogICAgICBfbXNnX3VpZCA9IG1kNSggIiVzJXMiICUgKCBzZWxmLmlkLCB0aW1lLnRpbWUoKSApICkuaGV4ZGlnZXN0KCkKICAgICAgX21zZyA9ICc8bG9nPjxpZD4lczwvaWQ+PGZhY2lsaXR5PkFtYXpvbl9FY2hvX1NlcnZlcjwvZmFjaWxpdHk+PHNldmVyaXR5PiVzPC9zZXZlcml0eT48bWVzc2FnZT4lczwvbWVzc2FnZT48L2xvZz4nICUgKF9tc2dfdWlkLCBzZXZlcml0eSwgbXNnKQogICAgICBzZWxmLnNlbmRUb091dHB1dCgxLF9tc2cpCiAgICBkZWYgc2VuZFRvT3V0cHV0KHNlbGYsIG91dCwgbXNnKToKICAgICAgb3V0IC09IDEKICAgICAgc2VsZi5sb2NhbHNbIkFOIl1bb3V0XSA9IG1zZwogICAgICBzZWxmLmxvY2Fsc1siQUMiXVtvdXRdID0gMSAgCg=='),'<13626_Amazon Echo (13626)>','exec'))"|""|0|0|0|0
## MD5 der Formelzeile: a6205d64fc8d6532145b6df8added75b
### Klasse AmazonEcho
################################
## Quelltext nicht Öffentlich ##
################################




## Klasse auf SN1 
5012|1|"EI"|"1"|"20"|0|1|0|0
5012|0|"OC[1]"|"AmazonEcho(locals())"|""|0|0|1|0

#5012|abbruch bei bed. (0/1)|bedingung|formel|zeit|pin-ausgang|pin-offset|pin-speicher|pin-neg.ausgang
5012|0|"(OC[1] or EC[1]) and EN[1]"|"SN[1].start()"|""|0|0|0|0
5012|0|"EC[1] and not EN[1]"|"SN[1].stop()"|""|0|0|0|0



